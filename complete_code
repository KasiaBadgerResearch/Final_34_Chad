# How has the prevalence of anemia among women of reproductive age evolved relative to the prevalence of anemia among children in Chad between 2000 and 2018?

import pandas as pd
import matplotlib.pyplot as plt
import os

# Folders
data_raw_folder = "data_raw/"
data_clean_folder = "data_clean/"
figures_folder = "figures/"

# Load CSV
filename = "health_tcd_filtered.csv"  # Filtered dataset with only relevant rows
df = pd.read_csv(os.path.join(data_raw_folder, filename))

# Keep only needed columns
df = df[["Year", "Indicator Name", "Value"]]

# Convert Year and Value to numeric, drop invalid rows
df["Year"] = pd.to_numeric(df["Year"], errors="coerce")
df["Value"] = pd.to_numeric(df["Value"], errors="coerce")
df = df.dropna(subset=["Year", "Value"])

# Pivot indicators into separate columns
df_pivot = df.pivot(index="Year", columns="Indicator Name", values="Value").reset_index()
df_pivot = df_pivot.sort_values("Year")

print("Pivoted Chad dataset:")
display(df_pivot)

# Interpolate missing values for smooth plotting (optional)
df_plot = df_pivot.interpolate(method='linear')

# Plot the two indicators
plt.figure(figsize=(10,6))
plt.plot(df_plot["Year"], df_plot["Prevalence of anemia among women of reproductive age (% of women ages 15-49)"], 
         marker='o', linestyle='-', label="Prevalence of anemia among women of reproductive age (% of women ages 15-49)")
plt.plot(df_plot["Year"], df_plot["Prevalence of anemia among children (% of children ages 6-59 months)"], 
         marker='o', linestyle='-', label="Prevalence of anemia among children (% of children ages 6-59 months)")

plt.title("Chad: Prevalence of anemia among women of repoductive age vs anemia among children (2000-2018)")
plt.xlabel("Year")
plt.ylabel("Percentage")
plt.legend()
plt.grid(True)
plt.tight_layout()
plt.savefig(os.path.join(figures_folder, "chad_prevalence_of_anemia_among_women_of_reproductive_age_vs_anemia_among_children.png"))
plt.show()

# Save cleaned CSV
df_pivot.to_csv(os.path.join(data_clean_folder, "chad_prevalence_of_anemia_among_women_of_reproductive_age_vs_anemia_among_children"), index=False)
